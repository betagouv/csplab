#!/usr/bin/env bash

set -eo pipefail

# read commit message
MESSAGE=$(cat "$1")

# commit message schema regex
SCHEMA_REGEX="^(ğŸ¨|âš¡ï¸|ğŸ”¥|ğŸ›|ğŸš‘ï¸|âœ¨|ğŸ“|ğŸš€|ğŸ’„|ğŸ‰|âœ…|ğŸ”’ï¸|ğŸ”|ğŸ”–|ğŸš¨|ğŸš§|ğŸ’š|â¬‡ï¸|â¬†ï¸|ğŸ“Œ|ğŸ‘·|ğŸ“ˆ|â™»ï¸|â•|â–|ğŸ”§|ğŸ”¨|ğŸŒ|âœï¸|ğŸ’©|âªï¸|ğŸ”€|ğŸ“¦ï¸|ğŸ‘½ï¸|ğŸšš|ğŸ“„|ğŸ’¥|ğŸ±|â™¿ï¸|ğŸ’¡|ğŸ»|ğŸ’¬|ğŸ—ƒï¸|ğŸ”Š|ğŸ”‡|ğŸ‘¥|ğŸš¸|ğŸ—ï¸|ğŸ“±|ğŸ¤¡|ğŸ¥š|ğŸ™ˆ|ğŸ“¸|âš—ï¸|ğŸ”ï¸|ğŸ·ï¸|ğŸŒ±|ğŸš©|ğŸ¥…|ğŸ’«|ğŸ—‘ï¸|ğŸ›‚|ğŸ©¹|ğŸ§|âš°ï¸|ğŸ§ª|ğŸ‘”|ğŸ©º|ğŸ§±|ğŸ§‘â€ğŸ’»|ğŸ’¸|ğŸ§µ|ğŸ¦º|âœˆï¸)\\([a-z0-9:-]+\\) [a-z].{1,50}"

# validate commit message schema
if ! echo "$MESSAGE" | grep -qE "$SCHEMA_REGEX"; then
    echo "âŒ Invalid commit message!"
    echo "Required format: <emoji>(<scope>) <subject>"
    echo "Example: âœ¨(auth) add support for HTTP basic auth"
    echo "Use 'bin/cz commit' for more assistance (requires that commitzen is installed on your system)"
    exit 1
fi
